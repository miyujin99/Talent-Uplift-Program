<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Successor Candidate Application Form + Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PDF export library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --ashley-orange: #f78e2f;
      --ashley-orange-dark: #d86f12;
      --bg-light: #f3f4f6;
      --text-main: #111827;
      --border-soft: #e5e7eb;
      --blue-soft: #e0ecff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 20px 20px 22px;
      margin-bottom: 18px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }

    /* ========== HEADER ========== */

    .header-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .title {
      font-size: 22px;
      font-weight: 800;
      color: var(--ashley-orange-dark);
      letter-spacing: 0.02em;
    }

    .subtitle {
      font-size: 13px;
      color: #4b5563;
      margin-bottom: 8px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #fff7ed;
      border: 1px solid #fed7aa;
      font-size: 11px;
      font-weight: 600;
      color: #9a3412;
      gap: 4px;
      white-space: nowrap;
    }

    .tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--ashley-orange);
    }

    .info-badge {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }

    /* ========== FORM SECTIONS ========== */

    .section-block {
      border-radius: 12px;
      padding: 14px 14px 10px;
      margin-bottom: 14px;
      background: linear-gradient(
          90deg,
          rgba(247, 142, 47, 0.09),
          rgba(59, 130, 246, 0.02)
        ),
        #ffffff;
      border-left: 4px solid var(--ashley-orange);
    }

    .section-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    h2.section-title {
      font-size: 15px;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #111827;
    }

    h2.section-title span.section-badge {
      font-size: 11px;
      font-weight: 800;
      text-transform: uppercase;
      color: #fb923c;
      background: #fff7ed;
      border-radius: 999px;
      padding: 2px 9px;
      border: 1px solid #fed7aa;
    }

    .section-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      white-space: nowrap;
    }

    .section-desc {
      font-size: 12px;
      color: #6b7280;
      margin: 0 0 10px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 16px;
    }

    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    .field {
      margin-bottom: 8px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .field-label .required {
      color: #dc2626;
    }

    .field-help {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 3px;
    }

    .field-error {
      font-size: 11px;
      color: #b91c1c;
      margin-top: 3px;
    }

    input[type="text"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      font-size: 13px;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background-color 0.15s;
      background: #f9fafb;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--ashley-orange);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(247, 142, 47, 0.15);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.4;
    }

    .pill-note {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      margin-bottom: 8px;
    }

    .preference-wrapper {
      border-radius: 10px;
      border: 1px dashed #e5e7eb;
      padding: 10px 10px 6px;
      margin-bottom: 8px;
      background: #f9fafb;
    }

    .preference-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .pref-title {
      font-size: 13px;
      font-weight: 700;
      color: #111827;
    }

    .pref-tag {
      font-size: 11px;
      color: #9ca3af;
    }

    .pref-dept-label {
      font-size: 11px;
      color: #4b5563;
      margin-top: 4px;
    }

    .checkbox-row,
    .radio-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 13px;
    }

    .checkbox-item,
    .radio-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkbox-item input,
    .radio-item input {
      margin: 0;
    }

    .consent-line {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
      align-items: flex-start;
      font-size: 12px;
      color: #374151;
    }

    .consent-line input {
      margin-top: 3px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 14px;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.15s, box-shadow 0.15s, transform 0.05s;
    }

    .btn-primary {
      background: linear-gradient(
        135deg,
        var(--ashley-orange),
        var(--ashley-orange-dark)
      );
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(248, 153, 60, 0.35);
    }

    .btn-primary:hover {
      background: linear-gradient(
        135deg,
        var(--ashley-orange-dark),
        #b45309
      );
      box-shadow: 0 6px 16px rgba(248, 153, 60, 0.45);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .btn-icon {
      font-size: 16px;
      line-height: 1;
    }

    .success-msg {
      font-size: 12px;
      color: #15803d;
      margin-top: 8px;
    }

    .json-output {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 10px;
      padding: 10px 12px;
      overflow: auto;
      max-height: 260px;
      border: 1px solid #0f172a;
    }

    .json-output strong {
      color: #facc15;
    }

    .has-error {
      border-color: #f97373 !important;
      background: #fef2f2 !important;
    }

    hr.soft {
      border: none;
      border-bottom: 1px dashed #e5e7eb;
      margin: 16px 0;
    }

    /* ========== MODAL & PROFILE (PDF) ========== */

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal.show {
      display: flex;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
    }

    .modal-dialog {
      position: relative;
      background: #f3f4f6;
      border-radius: 16px;
      max-width: 900px;
      width: 96%;
      max-height: 92vh;
      overflow: auto;
      padding: 18px 20px 20px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.65);
    }

    .modal-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 700;
    }

    .modal-close {
      border: none;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
      line-height: 1;
      color: #6b7280;
    }

    /* PDF wrapper roughly A4 width */
    #pdfWrapper {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px 18px 18px;
      border: 1px solid #e5e7eb;
      width: 800px;       /* ~ A4 width at 96dpi */
      max-width: 100%;
      margin: 0 auto;
    }

    .pdf-header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 10px;
      margin-bottom: 12px;
      background: linear-gradient(
        90deg,
        #f97316,
        #ea580c
      );
      color: #fefce8;
    }

    .pdf-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
    }

    .pdf-logo-box {
      width: 70px;
      height: 26px;
      border-radius: 999px;
      background: #fef3c7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      color: #b45309;
    }

    .pdf-header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
      font-size: 11px;
    }

    .pdf-tag {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(254, 243, 199, 0.9);
      background: rgba(254, 243, 199, 0.18);
      font-weight: 600;
    }

    .pdf-id {
      font-weight: 600;
      opacity: 0.95;
    }

    #candidateProfileCard {
      border-radius: 10px;
      border: 1px solid #dbeafe;
      padding: 12px 12px 14px;
      font-size: 13px;
      background: #f9fafb;
    }

    .profile-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 10px;
    }

    .profile-col {
      flex: 1 1 260px;
    }

    .box {
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 10px 10px 8px;
      height: 100%;
    }

    .box-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .box-header span.icon {
      font-size: 14px;
    }

    .box-subtitle {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .dl-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 12px;
      font-size: 12px;
    }

    .dl-grid dt {
      color: #6b7280;
    }

    .dl-grid dd {
      margin: 0;
      color: #111827;
    }

    .pill-small {
      font-size: 11px;
      border-radius: 999px;
      padding: 2px 7px;
      display: inline-block;
    }

    .pill-blue {
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .pill-yellow {
      background: #fef9c3;
      color: #854d0e;
      border: 1px solid #facc15;
    }

    .profile-sbi {
      font-size: 12px;
      margin-top: 4px;
    }

    .profile-sbi dt {
      font-weight: 600;
      color: #4b5563;
    }

    .profile-sbi dd {
      margin: 0 0 4px;
    }

    /* page break helper if ever needed */
    .page-break {
      page-break-before: always;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER -->
    <div class="card">
      <div class="header-main">
        <div>
          <div class="title">Successor Candidate Application</div>
          <div class="subtitle">
            Internal application form for Talent Uplift / Successor Pool (2025).
          </div>
        </div>
        <div class="tag">
          <span class="tag-dot"></span>
          <span>Stage 2 ‚Äì Candidate Application</span>
        </div>
      </div>
      <div class="info-badge">
        Please complete this form in English. Fields marked (*) are required.
      </div>
    </div>

    <!-- ========== FORM CARD ========== -->
    <form id="applicationForm" class="card" novalidate>
      <div id="successMessage" class="success-msg" style="display:none;">
        ‚úÖ Your application passed validation. A candidate profile preview has been generated. Please review and confirm in the popup window.
      </div>

      <!-- SECTION 1 ¬∑ CANDIDATE INFO -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 1</span>
            Candidate Information
          </h2>
          <div class="section-chip">üë§ Who you are</div>
        </div>
        <p class="section-desc">
          Basic details used for identification and to link your application to
          the nomination list.
        </p>

        <div class="grid-2">
          <div class="field">
            <label class="field-label" for="fullName">
              Full Name <span class="required">*</span>
            </label>
            <input
              type="text"
              id="fullName"
              name="fullName"
              autocomplete="off"
              placeholder="e.g., Nguyen Van A"
            />
            <div id="err-fullName" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="employeeId">
              Employee ID <span class="required">*</span>
            </label>
            <input
              type="text"
              id="employeeId"
              name="employeeId"
              autocomplete="off"
              placeholder="e.g., VN01234"
            />
            <div id="err-employeeId" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="workEmail">
              Work Email <span class="required">*</span>
            </label>
            <input
              type="email"
              id="workEmail"
              name="workEmail"
              autocomplete="off"
              placeholder="e.g., firstname.lastname@ashleyfurniture.com"
            />
            <div id="err-workEmail" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="currentDept">
              Current Department <span class="required">*</span>
            </label>
            <div class="field-help">
              Select the department you are currently assigned to.
            </div>
            <select id="currentDept" name="currentDept">
              <option value="">-- Select department --</option>
            </select>
            <div id="err-currentDept" class="field-error"></div>
          </div>
        </div>

        <div class="field">
          <label class="field-label" for="currentRole">
            Current Role / Position <span class="required">*</span>
          </label>
          <input
            type="text"
            id="currentRole"
            name="currentRole"
            placeholder="e.g., Team Leader of Product Development"
          />
          <div id="err-currentRole" class="field-error"></div>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 2 ¬∑ SUCCESSION PREFERENCES -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 2</span>
            Succession Preferences
          </h2>
          <div class="section-chip">üóÇÔ∏è Target roles</div>
        </div>
        <p class="section-desc">
          Select up to two roles you are interested in. At least one preference
          must be within your current department. Roles below are based on the
          VP-approved list for succession planning.
        </p>

        <div class="pill-note">
          <span>üí°</span>
          <span>Preference 1 is required. Preference 2 is optional but must be different.</span>
        </div>

        <!-- PREFERENCE 1 -->
        <div class="preference-wrapper">
          <div class="preference-header">
            <div class="pref-title">Preference 1 ‚Äì Primary Role</div>
            <div class="pref-tag">Required</div>
          </div>

          <div class="field">
            <label class="field-label" for="pref1Role">
              Target Role (Preference 1) <span class="required">*</span>
            </label>
            <select id="pref1Role" name="pref1Role">
              <option value="">-- Select role --</option>
            </select>
            <div id="pref1DeptLabel" class="pref-dept-label">
              Department: <em>--</em>
            </div>
            <div id="err-pref1Role" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="pref1Reason">
              Reason for Preference 1 <span class="required">*</span>
            </label>
            <div class="field-help">
              Why are you interested in this role and how does it support your
              development path?
            </div>
            <textarea
              id="pref1Reason"
              name="pref1Reason"
              minlength="30"
              placeholder="Please describe your motivation and how your strengths and aspirations fit this role (at least 2‚Äì3 lines)."
            ></textarea>
            <div id="err-pref1Reason" class="field-error"></div>
          </div>
        </div>

        <!-- PREFERENCE 2 -->
        <div class="preference-wrapper">
          <div class="preference-header">
            <div class="pref-title">Preference 2 ‚Äì Secondary Role</div>
            <div class="pref-tag">Optional</div>
          </div>

          <div class="field">
            <label class="field-label" for="pref2Role">
              Target Role (Preference 2)
            </label>
            <div class="field-help">
              Optional ‚Äì select only if you would like to be considered for a
              second role.
            </div>
            <select id="pref2Role" name="pref2Role">
              <option value="">-- No secondary preference --</option>
            </select>
            <div id="pref2DeptLabel" class="pref-dept-label">
              Department: <em>--</em>
            </div>
            <div id="err-pref2Role" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="pref2Reason">
              Reason for Preference 2
            </label>
            <div class="field-help">
              Required only if you choose a secondary role.
            </div>
            <textarea
              id="pref2Reason"
              name="pref2Reason"
              minlength="30"
              placeholder="Explain why this is also a suitable role for you."
            ></textarea>
            <div id="err-pref2Reason" class="field-error"></div>
          </div>
        </div>

        <!-- CROSS-DEPT JUSTIFICATION -->
        <div id="crossDeptBlock" class="field" style="display:none;">
          <label class="field-label" for="crossJustification">
            Cross-department Justification <span class="required">*</span>
          </label>
          <div class="field-help">
            This question appears because at least one of your preferences is in
            a different department from your current one.
          </div>
          <textarea
            id="crossJustification"
            name="crossJustification"
            placeholder="Describe your rationale for applying to a role in another department, including relevant experiences and how you plan to bridge any gaps."
          ></textarea>
          <div id="err-crossJustification" class="field-error"></div>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 3 ¬∑ ROLE-SPECIFIC (ALL MANAGERIAL) -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 3</span>
            Role-Specific Questions (Managerial)
          </h2>
          <div class="section-chip">üß≠ Leadership focus</div>
        </div>
        <p class="section-desc">
          As all target roles in this round are managerial, please describe your
          leadership approach and provide one example using the SBI
          (Situation‚ÄìBehavior‚ÄìImpact) format.
        </p>

        <div class="field">
          <label class="field-label" for="leadershipStyle">
            Future Leadership Style <span class="required">*</span>
          </label>
          <div class="field-help">
            How would you lead, motivate, and support your team in the target role?
          </div>
          <textarea
            id="leadershipStyle"
            name="leadershipStyle"
            minlength="30"
            placeholder="Share your view on how you would lead people in the future role."
          ></textarea>
          <div id="err-leadershipStyle" class="field-error"></div>
        </div>

        <div class="field">
          <label class="field-label">
            Example of Influencing or Motivating Others (SBI)
            <span class="required">*</span>
          </label>
          <div class="field-help">
            Please describe one situation where you influenced or motivated others, using 3 short parts below.
          </div>
          <div class="field">
            <label class="field-label" for="sbiSituation">
              Situation (S) <span class="required">*</span>
            </label>
            <textarea
              id="sbiSituation"
              name="sbiSituation"
              minlength="20"
              placeholder="What was happening? What was the context?"
            ></textarea>
            <div id="err-sbiSituation" class="field-error"></div>
          </div>
          <div class="field">
            <label class="field-label" for="sbiBehavior">
              Behavior (B) <span class="required">*</span>
            </label>
            <textarea
              id="sbiBehavior"
              name="sbiBehavior"
              minlength="20"
              placeholder="What did you do? What specific actions did you take?"
            ></textarea>
            <div id="err-sbiBehavior" class="field-error"></div>
          </div>
          <div class="field">
            <label class="field-label" for="sbiImpact">
              Impact (I) <span class="required">*</span>
            </label>
            <textarea
              id="sbiImpact"
              name="sbiImpact"
              minlength="20"
              placeholder="What changed as a result? What was the outcome for others, the team, or the business?"
            ></textarea>
            <div id="err-sbiImpact" class="field-error"></div>
          </div>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 4 ¬∑ CAREER ASPIRATION & MOBILITY -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 4</span>
            Career Aspiration & Mobility
          </h2>
          <div class="section-chip">‚ö° Direction & flexibility</div>
        </div>

        <div class="field">
          <label class="field-label" for="careerGoals">
            Short- to Mid-term Career Goals (1‚Äì3 years)
            <span class="required">*</span>
          </label>
          <textarea
            id="careerGoals"
            name="careerGoals"
            minlength="30"
            placeholder="Share the main directions you want to grow towards in the next 1‚Äì3 years."
          ></textarea>
          <div id="err-careerGoals" class="field-error"></div>
        </div>

        <div class="field">
          <label class="field-label" for="motivation">
            Why Do You Want to Be Considered for These Role(s)?
            <span class="required">*</span>
          </label>
          <textarea
            id="motivation"
            name="motivation"
            minlength="30"
            placeholder="Explain your motivation for joining the successor/Talent Uplift pool and being considered for the selected role(s)."
          ></textarea>
          <div id="err-motivation" class="field-error"></div>
        </div>

        <div class="field">
          <label class="field-label">
            Willingness to Change Department <span class="required">*</span>
          </label>
          <div class="radio-row">
            <label class="radio-item">
              <input type="radio" name="changeDept" value="yes" />
              Yes
            </label>
            <label class="radio-item">
              <input type="radio" name="changeDept" value="maybe" />
              Maybe / Depends on role
            </label>
            <label class="radio-item">
              <input type="radio" name="changeDept" value="no" />
              No
            </label>
          </div>
          <div id="err-changeDept" class="field-error"></div>
        </div>

        <div class="field">
          <label class="field-label">
            Willingness to Relocate <span class="required">*</span>
          </label>
          <div class="field-help">
            Tick all that apply. At least one option is required.
          </div>
          <div class="checkbox-row">
            <label class="checkbox-item">
              <input
                type="checkbox"
                name="relocateOptions"
                value="same_province"
              />
              Within same province / city
            </label>
            <label class="checkbox-item">
              <input
                type="checkbox"
                name="relocateOptions"
                value="other_provinces"
              />
              Other provinces in Vietnam
            </label>
            <label class="checkbox-item">
              <input
                type="checkbox"
                name="relocateOptions"
                value="overseas"
              />
              Overseas (Asia)
            </label>
            <label class="checkbox-item">
              <input
                type="checkbox"
                name="relocateOptions"
                value="not_willing"
              />
              Not willing to relocate
            </label>
          </div>
          <div id="err-relocateOptions" class="field-error"></div>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 5 ¬∑ OPTIONAL SELF-LEADERSHIP -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 5</span>
            Optional ‚Äì Self-leadership Reflection
          </h2>
          <div class="section-chip">üå± Ownership of growth</div>
        </div>
        <p class="section-desc">
          You may share an example where you took ownership of your own
          learning, performance, or development (optional but helpful).
        </p>

        <div class="field">
          <label class="field-label" for="selfLeadership">
            Example of Self-Leadership (Optional)
          </label>
          <textarea
            id="selfLeadership"
            name="selfLeadership"
            placeholder="Describe a recent moment where you took initiative for your own growth or performance."
          ></textarea>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 6 ¬∑ CONSENT -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 6</span>
            Program Understanding & Consent
          </h2>
          <div class="section-chip">‚úÖ Confirmation</div>
        </div>

        <div class="field">
          <div class="consent-line">
            <input
              type="checkbox"
              id="consentDevelopment"
              name="consentDevelopment"
            />
            <label for="consentDevelopment">
              I understand that this program focuses on my development and
              readiness and does not guarantee immediate promotion.
            </label>
          </div>
          <div class="consent-line">
            <input
              type="checkbox"
              id="consentSharing"
              name="consentSharing"
            />
            <label for="consentSharing">
              I understand that my role preferences and application may be
              shared with relevant Department Heads and HR for review and
              follow-up development.
            </label>
          </div>
          <div class="consent-line">
            <input
              type="checkbox"
              id="consentAccuracy"
              name="consentAccuracy"
            />
            <label for="consentAccuracy">
              I confirm that the information provided in this form is accurate
              to the best of my knowledge.
            </label>
          </div>
          <div id="err-consents" class="field-error"></div>
        </div>
      </section>

      <!-- ACTIONS -->
      <div class="btn-row">
        <button type="reset" class="btn btn-secondary" id="btnReset">
          Clear
        </button>
        <button type="submit" class="btn btn-primary">
          <span class="btn-icon">üì§</span>
          <span>Submit Application</span>
        </button>
      </div>
    </form>

    <!-- ========== PROFILE MODAL ========== -->
    <div id="profileModal" class="modal">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog">
        <div class="modal-header-row">
          <div class="modal-title">Candidate Profile ‚Äì Preview</div>
          <button type="button" id="closeModalBtn" class="modal-close" aria-label="Close">
            √ó
          </button>
        </div>

        <!-- PDF CONTENT -->
        <div id="pdfWrapper">
          <div class="pdf-header-bar">
            <div class="pdf-header-left">
              <div class="pdf-logo-box">Ashley</div>
              <div>
                <div style="font-weight:700;font-size:13px;">
                  TALENT UPLIFT / SUCCESSOR POOL 2025
                </div>
                <div style="font-size:11px;opacity:0.9;">
                  Candidate Profile Summary
                </div>
              </div>
            </div>
            <div class="pdf-header-right">
              <div class="pdf-tag">Stage 2 ‚Äì Candidate Application</div>
              <div class="pdf-id" id="pdfEmployeeId">ID: ‚Äî</div>
            </div>
          </div>

          <div id="candidateProfileCard">
            <!-- ROW 1 -->
            <div class="profile-row">
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üë§</span>
                    <span>Basic Info</span>
                  </div>
                  <dl class="dl-grid">
                    <div>
                      <dt>Full name</dt>
                      <dd id="bi-name">‚Äî</dd>
                    </div>
                    <div>
                      <dt>Department</dt>
                      <dd id="bi-dept">‚Äî</dd>
                    </div>
                    <div style="grid-column:1 / -1;">
                      <dt>Current role</dt>
                      <dd id="bi-role">‚Äî</dd>
                    </div>
                  </dl>
                </div>
              </div>

              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üß≠</span>
                    <span>Role-Specific ‚Äì Leadership</span>
                  </div>
                  <div class="box-subtitle">
                    How the candidate plans to lead and an example using SBI.
                  </div>
                  <div id="profile-leadershipStyle" style="font-size:12px;margin-bottom:6px;">
                    ‚Äî
                  </div>
                  <dl class="profile-sbi">
                    <div>
                      <dt>Situation (S)</dt>
                      <dd id="profile-sbiS">‚Äî</dd>
                    </div>
                    <div>
                      <dt>Behavior (B)</dt>
                      <dd id="profile-sbiB">‚Äî</dd>
                    </div>
                    <div>
                      <dt>Impact (I)</dt>
                      <dd id="profile-sbiI">‚Äî</dd>
                    </div>
                  </dl>
                </div>
              </div>
            </div>

            <!-- ROW 2 -->
            <div class="profile-row">
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üóÇÔ∏è</span>
                    <span>Succession Preferences</span>
                  </div>
                  <div class="box-subtitle">
                    At least one preference should be in the current department.
                  </div>
                  <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;">
                    <div>
                      <div class="pill-small pill-blue" style="margin-bottom:3px;">1st Preference</div>
                      <div id="pref1">‚Äî</div>
                    </div>
                    <div>
                      <div class="pill-small pill-blue" style="margin-bottom:3px;">2nd Preference</div>
                      <div id="pref2">‚Äî</div>
                      <div id="crossNotice" class="pill-small pill-yellow" style="margin-top:4px;display:none;">
                        Cross-dept
                      </div>
                    </div>
                  </div>
                  <div style="margin-top:6px;font-size:11px;">
                    <strong>Reason (1st):</strong>
                    <span id="rs1">‚Äî</span>
                  </div>
                  <div style="margin-top:3px;font-size:11px;">
                    <strong>Reason (2nd):</strong>
                    <span id="rs2">‚Äî</span>
                  </div>
                </div>
              </div>

              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üöö</span>
                    <span>Mobility & Availability</span>
                  </div>
                  <dl class="dl-grid">
                    <div>
                      <dt>Willing to relocate?</dt>
                      <dd id="mob-relocate">‚Äî</dd>
                    </div>
                    <div>
                      <dt>Open to change dept?</dt>
                      <dd id="mob-change">‚Äî</dd>
                    </div>
                  </dl>
                </div>
              </div>
            </div>

            <!-- ROW 3 -->
            <div class="profile-row">
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">‚ö°</span>
                    <span>Career Aspiration & Motivation</span>
                  </div>
                  <div class="box-subtitle">
                    Short- to mid-term direction and why the roles matter.
                  </div>
                  <div style="font-size:12px;margin-bottom:4px;">
                    <strong>Career goals (1‚Äì3 years):</strong>
                    <div id="asp-short">‚Äî</div>
                  </div>
                  <div style="font-size:12px;">
                    <strong>Motivation for these roles:</strong>
                    <div id="asp-mid">‚Äî</div>
                  </div>
                </div>
              </div>

              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üå±</span>
                    <span>Optional ‚Äì Self-leadership</span>
                  </div>
                  <div id="profile-selfLeadership" style="font-size:12px;">
                    ‚Äî
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Buttons under modal -->
        <div class="btn-row" style="margin-top:14px;">
          <button type="button" class="btn btn-secondary" id="backToFormBtn">
            ‚¨Ö Back to form
          </button>
          <button type="button" class="btn btn-primary" id="finalSubmitBtn">
            ‚úÖ Confirm & Download JSON + PDF
          </button>
        </div>
      </div>
    </div>

    <!-- JSON PREVIEW / DEBUG -->
    <div class="card">
      <h2 class="section-title">
        <span class="section-badge">Debug</span>
        JSON Preview (for Testing)
      </h2>
      <p class="section-desc">
        This section is for testing only. It shows the final JSON payload that will be sent to your backend / SharePoint workflow.
      </p>

      <div style="margin-bottom:10px;">
        <button id="loadSampleBtn" type="button" class="btn btn-secondary">
          üîÑ Load Sample Data
        </button>
      </div>

      <div id="jsonOutput" class="json-output">
        <strong>Waiting for submission‚Ä¶</strong>
      </div>
    </div>
  </div>

  <script>
    // ===============================
    // CONFIG ¬∑ DEPARTMENTS & ROLES
    // ===============================

    const departments = [
      "Asia Human Resources",
      "Engineering",
      "Product Development",
      "Quality Assurance",
      "Strategy Execution",
      "Strategic Sourcing",
      "CGI / Creative",
      "Sourcing Operations",
      "Material Sourcing",
      "Others"
    ];

    // All roles treated as managerial in this version
    const targetRoles = [
      // Asia Human Resources
      {
        id: "AHR_STL_TD",
        title: "Senior Talent Development Specialist",
        dept: "Asia Human Resources",
        type: "managerial"
      },
      {
        id: "AHR_MGR_HR_ADMIN",
        title: "Manager of HR and Admin",
        dept: "Asia Human Resources",
        type: "managerial"
      },

      // Engineering
      {
        id: "ENG_PM",
        title: "Engineering Project Manager",
        dept: "Engineering",
        type: "managerial"
      },
      {
        id: "ENG_MGR",
        title: "Manager of Engineering",
        dept: "Engineering",
        type: "managerial"
      },
      {
        id: "ENG_TL_COMPLIANCE",
        title: "Senior Team Leader of Compliance Engineering",
        dept: "Engineering",
        type: "managerial"
      },
      {
        id: "ENG_PROCESS_ENG",
        title: "Process Engineer",
        dept: "Engineering",
        type: "managerial"
      },
      {
        id: "ENG_PACKAGING_ENG",
        title: "Packaging Engineer",
        dept: "Engineering",
        type: "managerial"
      },

      // Product Development
      {
        id: "PD_MGR",
        title: "Manager of Product Development",
        dept: "Product Development",
        type: "managerial"
      },
      {
        id: "PD_TL_DEV",
        title: "Team Leader of Product Development",
        dept: "Product Development",
        type: "managerial"
      },
      {
        id: "PD_TL_MATERIAL",
        title: "Team Leader of Product Development Material",
        dept: "Product Development",
        type: "managerial"
      },
      {
        id: "PD_3D_ARTIST",
        title: "3D Artist",
        dept: "Product Development",
        type: "managerial"
      },

      // Quality Assurance
      {
        id: "QA_VENDOR_CHAMP",
        title: "Vendor Champion",
        dept: "Quality Assurance",
        type: "managerial"
      },
      {
        id: "QA_TL_PERF_TEST",
        title: "Team Leader of Performance Testing",
        dept: "Quality Assurance",
        type: "managerial"
      },
      {
        id: "QA_MATERIAL_ASSURANCE",
        title: "Material Assurance Specialist",
        dept: "Quality Assurance",
        type: "managerial"
      },

      // Strategy Execution
      {
        id: "STR_EXEC_MGR",
        title: "Manager of Strategy Execution",
        dept: "Strategy Execution",
        type: "managerial"
      },
      {
        id: "STR_EXEC_ASSOC",
        title: "Process Integration Associate",
        dept: "Strategy Execution",
        type: "managerial"
      },

      // Strategic Sourcing
      {
        id: "SS_MGR",
        title: "Manager of Strategic Sourcing",
        dept: "Strategic Sourcing",
        type: "managerial"
      },
      {
        id: "SS_MATERIAL_SOURCING",
        title: "Material Sourcing Specialist",
        dept: "Strategic Sourcing",
        type: "managerial"
      },
      {
        id: "SS_COST_ANALYST",
        title: "Cost Analyst",
        dept: "Strategic Sourcing",
        type: "managerial"
      },

      // CGI / Creative
      {
        id: "CGI_PHOTOGRAPHER",
        title: "CGI Photographer",
        dept: "CGI / Creative",
        type: "managerial"
      },
      {
        id: "CGI_3D_ANIM",
        title: "3D Animation Artist",
        dept: "CGI / Creative",
        type: "managerial"
      },

      // Sourcing Operations
      {
        id: "SO_INDUSTRIAL_ENG",
        title: "Industrial Engineer",
        dept: "Sourcing Operations",
        type: "managerial"
      },
      {
        id: "SO_FIELD_TEST_COORD",
        title: "Field Testing Coordinator",
        dept: "Sourcing Operations",
        type: "managerial"
      }
    ];

    const rolesMap = {};
    targetRoles.forEach((r) => {
      rolesMap[r.id] = r;
    });

    let lastPayload = null; // l∆∞u payload sau form submit ƒë√£ pass

    // ===============================
    // DOM HELPERS
    // ===============================

    function $(id) {
      return document.getElementById(id);
    }

    function getSelectedRole(roleSelectId) {
      const select = $(roleSelectId);
      const value = select.value;
      if (!value) return null;
      return rolesMap[value] || null;
    }

    function setDeptLabel(labelId, role) {
      const el = $(labelId);
      if (!el) return;
      if (!role) {
        el.innerHTML = 'Department: <em>--</em>';
      } else {
        el.innerHTML =
          "Department: <strong>" +
          role.dept +
          "</strong> ¬∑ <span style='font-size:11px;color:#6b7280'>(Managerial)</span>";
      }
    }

    function getRelocateSelections() {
      const checked = Array.from(
        document.querySelectorAll('input[name="relocateOptions"]:checked')
      );
      return checked.map((c) => c.value);
    }

    function getRadioValue(name) {
      const checked = document.querySelector(
        'input[name="' + name + '"]:checked'
      );
      return checked ? checked.value : "";
    }

    // ===============================
    // INIT FORM OPTIONS
    // ===============================

    function initDepartments() {
      const deptSelect = $("currentDept");
      departments.forEach((dept) => {
        const opt = document.createElement("option");
        opt.value = dept;
        opt.textContent = dept;
        deptSelect.appendChild(opt);
      });
    }

    function initRoles() {
      const pref1 = $("pref1Role");
      const pref2 = $("pref2Role");

      targetRoles.forEach((role) => {
        const text = role.dept + " ‚Äì " + role.title;

        const opt1 = document.createElement("option");
        opt1.value = role.id;
        opt1.textContent = text;
        pref1.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = role.id;
        opt2.textContent = text;
        pref2.appendChild(opt2);
      });
    }

    // ===============================
    // DYNAMIC VISIBILITY
    // ===============================

    function updateRoleDependentUI() {
      const currentDept = $("currentDept").value;
      const pref1Role = getSelectedRole("pref1Role");
      const pref2Role = getSelectedRole("pref2Role");

      // update dept labels
      setDeptLabel("pref1DeptLabel", pref1Role);
      setDeptLabel("pref2DeptLabel", pref2Role);

      // Preference 2 reason required only if Pref2 selected
      $("pref2Reason").required = !!pref2Role;

      // Cross-dept block logic
      let anyCrossDept = false;
      if (currentDept && pref1Role && pref1Role.dept !== currentDept) {
        anyCrossDept = true;
      }
      if (currentDept && pref2Role && pref2Role.dept !== currentDept) {
        anyCrossDept = true;
      }

      const crossBlock = $("crossDeptBlock");
      if (anyCrossDept) {
        crossBlock.style.display = "block";
      } else {
        crossBlock.style.display = "none";
      }
    }

    // ===============================
    // ERROR HANDLING
    // ===============================

    function clearAllErrors() {
      document.querySelectorAll(".field-error").forEach((el) => {
        el.textContent = "";
      });
      document
        .querySelectorAll(".has-error")
        .forEach((el) => el.classList.remove("has-error"));
    }

    function setError(fieldId, message) {
      const field = $(fieldId);
      const errEl = $("err-" + fieldId) || (field && field.nextElementSibling);
      if (errEl) errEl.textContent = message;
      if (field) field.classList.add("has-error");
    }

    // ===============================
    // LOAD SAMPLE DATA BUTTON
    // ===============================

    function loadSampleData() {
      // Reset dropdown options
      $("currentDept").innerHTML =
        '<option value="">-- Select department --</option>';
      $("pref1Role").innerHTML =
        '<option value="">-- Select role --</option>';
      $("pref2Role").innerHTML =
        '<option value="">-- No secondary preference --</option>';

      // Reload options
      initDepartments();
      initRoles();

      clearAllErrors();

      // ===== BASIC INFO =====
      $("fullName").value = "Nguyen Van A";
      $("employeeId").value = "VN01234";
      $("workEmail").value = "nguyen.van.a@ashleyfurniture.com";
      $("currentDept").value = "Engineering";
      $("currentRole").value = "Process Engineer";

      // ===== PREFERENCES =====
      $("pref1Role").value = "ENG_PM"; // Engineering Project Manager
      $("pref1Reason").value =
        "I aim to grow into a project leadership role where I can coordinate cross-functional work, manage timelines, and deliver impactful engineering outcomes for both factory and commercial teams.";

      $("pref2Role").value = "STR_EXEC_MGR"; // Manager of Strategy Execution
      $("pref2Reason").value =
        "I am also interested in Strategy Execution because it connects data, projects and business priorities. This role would allow me to work across departments and drive initiatives that improve execution discipline.";

      $("crossJustification").value =
        "My current role in Engineering already requires frequent collaboration with Strategy Execution on project timelines, risk tracking and improvement initiatives, so I have relevant exposure and interest in this area.";

      // ===== ROLE-SPECIFIC =====
      $("leadershipStyle").value =
        "I try to lead with clarity, trust and support. I focus on setting clear expectations, giving regular feedback, and creating space for team members to share ideas and take ownership of their tasks.";
      $("sbiSituation").value =
        "Our project team was facing delays due to conflicting priorities and unclear handover between functions.";
      $("sbiBehavior").value =
        "I organised a short alignment session, clarified milestones, reassigned some tasks based on strengths, and set up weekly check-ins to track risk and support team members.";
      $("sbiImpact").value =
        "The team caught up on the timeline, reported higher clarity and confidence, and stakeholders recognised the team for the improved coordination.";

      // ===== CAREER & MOTIVATION =====
      $("careerGoals").value =
        "In the next 1‚Äì3 years, I want to strengthen my project management capability, cross-functional collaboration and leadership skills so that I can handle larger regional projects and lead a small team.";
      $("motivation").value =
        "I want to be considered for these roles because I believe I can contribute more by coordinating people, processes and data, not only by doing individual engineering tasks. I am committed to long-term development with Ashley and ready to invest effort to grow into these roles.";

      // ===== MOBILITY =====
      document
        .querySelectorAll('input[name="changeDept"]')
        .forEach((x) => (x.checked = false));
      document.querySelector(
        'input[name="changeDept"][value="maybe"]'
      ).checked = true;

      document
        .querySelectorAll('input[name="relocateOptions"]')
        .forEach((c) => (c.checked = false));
      document.querySelector(
        'input[name="relocateOptions"][value="same_province"]'
      ).checked = true;
      document.querySelector(
        'input[name="relocateOptions"][value="other_provinces"]'
      ).checked = true;

      // ===== OPTIONAL SELF-LEADERSHIP =====
      $("selfLeadership").value =
        "I created a 3-month self-learning plan on data visualisation, studied after working hours, and then built dashboards that help my manager track defect trends and make faster decisions.";

      // ===== CONSENTS =====
      $("consentDevelopment").checked = true;
      $("consentSharing").checked = true;
      $("consentAccuracy").checked = true;

      // Update dynamic UI
      updateRoleDependentUI();

      alert(
        "Sample data loaded! Now you can click Submit Application and it should pass all validations."
      );
    }

    // ===============================
    // VALIDATION
    // ===============================

    function validateForm() {
      clearAllErrors();
      let hasError = false;

      const fullName = $("fullName").value.trim();
      const employeeId = $("employeeId").value.trim();
      const workEmail = $("workEmail").value.trim();
      const currentDept = $("currentDept").value;
      const currentRole = $("currentRole").value.trim();

      if (!fullName) {
        setError("fullName", "Please enter your Full Name.");
        hasError = true;
      }
      if (!employeeId) {
        setError("employeeId", "Please enter your Employee ID.");
        hasError = true;
      }
      if (!workEmail) {
        setError("workEmail", "Please enter your Work Email.");
        hasError = true;
      }
      if (!currentDept) {
        setError("currentDept", "Please select your current Department.");
        hasError = true;
      }
      if (!currentRole) {
        setError("currentRole", "Please enter your Current Role / Position.");
        hasError = true;
      }

      const pref1Role = getSelectedRole("pref1Role");
      const pref2Role = getSelectedRole("pref2Role");

      if (!pref1Role) {
        setError("pref1Role", "Please select your Preference 1 role.");
        hasError = true;
      }

      const pref1Reason = $("pref1Reason").value.trim();
      if (!pref1Reason || pref1Reason.length < 30) {
        setError(
          "pref1Reason",
          "Please provide a meaningful reason for Preference 1 (at least 2‚Äì3 lines)."
        );
        hasError = true;
      }

      const pref2Reason = $("pref2Reason").value.trim();
      if (pref2Role && (!pref2Reason || pref2Reason.length < 30)) {
        setError(
          "pref2Reason",
          "Please provide a meaningful reason for Preference 2 (at least 2‚Äì3 lines)."
        );
        hasError = true;
      }

      // Preference 2 must be different
      if (pref1Role && pref2Role && pref1Role.id === pref2Role.id) {
        setError(
          "pref2Role",
          "Preference 2 must be different from Preference 1."
        );
        hasError = true;
      }

      // At least 1 preference must be within current department
      if (currentDept && pref1Role) {
        const pref1InDept = pref1Role.dept === currentDept;
        const pref2InDept =
          pref2Role && pref2Role.dept === currentDept;
        if (!pref1InDept && !pref2InDept) {
          setError(
            "pref1Role",
            "At least one of your preferences must be within your current department."
          );
          setError(
            "pref2Role",
            "At least one of your preferences must be within your current department."
          );
          hasError = true;
        }
      }

      // Cross-dept justification if needed
      const crossBlockVisible =
        $("crossDeptBlock").style.display !== "none";
      if (crossBlockVisible) {
        const crossText = $("crossJustification").value.trim();
        if (!crossText || crossText.length < 20) {
          setError(
            "crossJustification",
            "Please explain your reasoning for applying to a role in another department."
          );
          hasError = true;
        }
      }

      // Leadership & SBI
      const leadershipStyle = $("leadershipStyle").value.trim();
      if (!leadershipStyle || leadershipStyle.length < 30) {
        setError(
          "leadershipStyle",
          "Please describe your future leadership style (at least a few lines)."
        );
        hasError = true;
      }

      const s = $("sbiSituation").value.trim();
      const b = $("sbiBehavior").value.trim();
      const i = $("sbiImpact").value.trim();
      if (!s || s.length < 20) {
        setError(
          "sbiSituation",
          "Please describe the situation (at least a few lines)."
        );
        hasError = true;
      }
      if (!b || b.length < 20) {
        setError(
          "sbiBehavior",
          "Please describe your actions (Behavior) in this example."
        );
        hasError = true;
      }
      if (!i || i.length < 20) {
        setError(
          "sbiImpact",
          "Please describe the impact and result of your actions."
        );
        hasError = true;
      }

      // Career & motivation
      const careerGoals = $("careerGoals").value.trim();
      const motivation = $("motivation").value.trim();

      if (!careerGoals || careerGoals.length < 30) {
        setError(
          "careerGoals",
          "Please describe your short- to mid-term career goals (at least a few lines)."
        );
        hasError = true;
      }
      if (!motivation || motivation.length < 30) {
        setError(
          "motivation",
          "Please explain why you want to be considered for these role(s) (at least a few lines)."
        );
        hasError = true;
      }

      // Mobility
      const changeDept = getRadioValue("changeDept");
      if (!changeDept) {
        $("err-changeDept").textContent =
          "Please indicate your willingness to change department.";
        hasError = true;
      }

      const relocateSelections = getRelocateSelections();
      if (relocateSelections.length === 0) {
        $("err-relocateOptions").textContent =
          "Please select at least one option for your willingness to relocate.";
        hasError = true;
      }

      // Consents
      let consErr = "";
      if (!$("consentDevelopment").checked) {
        consErr =
          "Please confirm your understanding about development vs promotion.";
      }
      if (!$("consentSharing").checked) {
        consErr =
          (consErr ? consErr + " " : "") +
          "Please confirm your understanding that your application may be shared with relevant stakeholders.";
      }
      if (!$("consentAccuracy").checked) {
        consErr =
          (consErr ? consErr + " " : "") +
          "Please confirm that your information is accurate to the best of your knowledge.";
      }
      if (consErr) {
        $("err-consents").textContent = consErr;
        hasError = true;
      }

      return !hasError;
    }

    // ===============================
    // BUILD PAYLOAD FROM FORM
    // ===============================

    function buildPayloadFromForm() {
      const pref1Role = getSelectedRole("pref1Role");
      const pref2Role = getSelectedRole("pref2Role");

      const payload = {
        meta: {
          submittedAt: new Date().toISOString()
        },
        candidate: {
          fullName: $("fullName").value.trim(),
          employeeId: $("employeeId").value.trim(),
          workEmail: $("workEmail").value.trim(),
          currentDept: $("currentDept").value,
          currentRole: $("currentRole").value.trim()
        },
        preferences: {
          preference1: pref1Role
            ? {
                roleId: pref1Role.id,
                roleTitle: pref1Role.title,
                department: pref1Role.dept,
                type: pref1Role.type,
                reason: $("pref1Reason").value.trim()
              }
            : null,
          preference2: pref2Role
            ? {
                roleId: pref2Role.id,
                roleTitle: pref2Role.title,
                department: pref2Role.dept,
                type: pref2Role.type,
                reason: $("pref2Reason").value.trim()
              }
            : null,
          crossDepartmentJustification:
            $("crossJustification").value.trim() || null
        },
        roleSpecific: {
          leadershipStyle: $("leadershipStyle").value.trim(),
          sbiSituation: $("sbiSituation").value.trim(),
          sbiBehavior: $("sbiBehavior").value.trim(),
          sbiImpact: $("sbiImpact").value.trim()
        },
        careerAndMobility: {
          careerGoals: $("careerGoals").value.trim(),
          motivation: $("motivation").value.trim(),
          willingChangeDept: getRadioValue("changeDept"),
          willingRelocate: getRelocateSelections(),
          selfLeadershipExample:
            $("selfLeadership").value.trim() || null
        },
        consents: {
          developmentVsPromotion: $("consentDevelopment").checked,
          sharingWithHoDsAndHR: $("consentSharing").checked,
          accuracyConfirmed: $("consentAccuracy").checked
        }
      };

      return payload;
    }

    function showJsonPreview(payload) {
      const el = $("jsonOutput");
      el.textContent = JSON.stringify(payload, null, 2);
    }

    // ===============================
    // PROFILE CARD POPULATION
    // ===============================

    function humanizeRelocate(arr) {
      if (!arr || arr.length === 0) return "‚Äî";
      const mapping = {
        same_province: "Within same province / city",
        other_provinces: "Other provinces in Vietnam",
        overseas: "Overseas (Asia)",
        not_willing: "Not willing to relocate"
      };
      return arr.map((v) => mapping[v] || v).join(", ");
    }

    function humanizeChangeDept(val) {
      if (val === "yes") return "Yes";
      if (val === "maybe") return "Maybe / depends on role";
      if (val === "no") return "No";
      return "‚Äî";
    }

    function fillProfileCard(payload) {
      // header ID
      $("pdfEmployeeId").textContent =
        "ID: " + (payload.candidate.employeeId || "‚Äî");

      // Basic info
      $("bi-name").innerText = payload.candidate.fullName || "‚Äî";
      $("bi-dept").innerText = payload.candidate.currentDept || "‚Äî";
      $("bi-role").innerText = payload.candidate.currentRole || "‚Äî";

      // Preferences
      const p1 = payload.preferences.preference1;
      const p2 = payload.preferences.preference2;

      if (p1) {
        $("pref1").innerText = p1.roleTitle + " (" + p1.department + ")";
      } else {
        $("pref1").innerText = "‚Äî";
      }

      if (p2) {
        $("pref2").innerText = p2.roleTitle + " (" + p2.department + ")";
      } else {
        $("pref2").innerText = "‚Äî";
      }

      // Cross-dept badge for 2nd preference
      const currentDept = payload.candidate.currentDept;
      if (p2 && currentDept && p2.department !== currentDept) {
        $("crossNotice").style.display = "inline-block";
      } else {
        $("crossNotice").style.display = "none";
      }

      // Reasons
      $("rs1").innerText = (p1 && p1.reason) || "‚Äî";
      $("rs2").innerText = (p2 && p2.reason) || "‚Äî";

      // Mobility
      $("mob-relocate").innerText = humanizeRelocate(
        payload.careerAndMobility.willingRelocate
      );
      $("mob-change").innerText = humanizeChangeDept(
        payload.careerAndMobility.willingChangeDept
      );

      // Aspiration
      $("asp-short").innerText =
        payload.careerAndMobility.careerGoals || "‚Äî";
      $("asp-mid").innerText =
        payload.careerAndMobility.motivation || "‚Äî";

      // Leadership & SBI
      $("profile-leadershipStyle").innerText =
        payload.roleSpecific.leadershipStyle || "‚Äî";
      $("profile-sbiS").innerText =
        payload.roleSpecific.sbiSituation || "‚Äî";
      $("profile-sbiB").innerText =
        payload.roleSpecific.sbiBehavior || "‚Äî";
      $("profile-sbiI").innerText =
        payload.roleSpecific.sbiImpact || "‚Äî";

      // Optional self-leadership
      $("profile-selfLeadership").innerText =
        payload.careerAndMobility.selfLeadershipExample || "‚Äî";
    }

    // ===============================
    // PDF & JSON DOWNLOAD
    // ===============================

    function downloadJson(payload) {
      const json = JSON.stringify(payload, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const employeeId =
        (payload.candidate.employeeId || "candidate")
          .replace(/[^a-zA-Z0-9_-]/g, "_");
      const fileName =
        "successor_application_" + employeeId + ".json";

      const a = document.createElement("a");
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function downloadProfilePdf(payload) {
      const element = $("pdfWrapper");
      const employeeId =
        (payload.candidate.employeeId || "candidate")
          .replace(/[^a-zA-Z0-9_-]/g, "_");

      const opt = {
        margin: [10, 10, 10, 10],
        filename: "candidate_profile_" + employeeId + ".pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
        pagebreak: { mode: ["css", "legacy"] }
      };

      // Ensure modal (and pdfWrapper) are visible
      html2pdf().set(opt).from(element).save();
    }

    // ===============================
    // MAIN INIT
    // ===============================

    document.addEventListener("DOMContentLoaded", function () {
      initDepartments();
      initRoles();
      updateRoleDependentUI();

      // change/blur listeners to update UI & inline validation
      $("currentDept").addEventListener("change", function () {
        updateRoleDependentUI();
        validateForm();
      });
      $("pref1Role").addEventListener("change", function () {
        updateRoleDependentUI();
        validateForm();
      });
      $("pref2Role").addEventListener("change", function () {
        updateRoleDependentUI();
        validateForm();
      });

      const validateOnBlurIds = [
        "fullName",
        "employeeId",
        "workEmail",
        "currentRole",
        "pref1Reason",
        "pref2Reason",
        "crossJustification",
        "leadershipStyle",
        "sbiSituation",
        "sbiBehavior",
        "sbiImpact",
        "careerGoals",
        "motivation"
      ];
      validateOnBlurIds.forEach((id) => {
        const el = $(id);
        if (el) {
          el.addEventListener("blur", () => {
            validateForm();
          });
        }
      });

      // Sample loader
      $("loadSampleBtn").addEventListener("click", function () {
        loadSampleData();
      });

      // Form submit
      $("applicationForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const valid = validateForm();

        if (valid) {
          const payload = buildPayloadFromForm();
          lastPayload = payload;

          showJsonPreview(payload);
          fillProfileCard(payload);

          $("successMessage").style.display = "block";

          // open modal
          $("profileModal").classList.add("show");
        } else {
          $("successMessage").style.display = "none";
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });

      // Reset
      $("btnReset").addEventListener("click", function () {
        clearAllErrors();
        $("jsonOutput").innerHTML =
          "<strong>Waiting for submission‚Ä¶</strong>";
        $("successMessage").style.display = "none";
        lastPayload = null;
        setTimeout(updateRoleDependentUI, 10);
      });

      // Modal controls
      $("closeModalBtn").addEventListener("click", function () {
        $("profileModal").classList.remove("show");
      });

      $("backToFormBtn").addEventListener("click", function () {
        $("profileModal").classList.remove("show");
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      $("finalSubmitBtn").addEventListener("click", function () {
        if (!lastPayload) {
          alert("Please submit the application form first.");
          return;
        }
        const finalPayload = lastPayload; // lu√¥n ƒë·ªìng nh·∫•t form ‚Äì profile
        showJsonPreview(finalPayload);
        downloadJson(finalPayload);
        downloadProfilePdf(finalPayload);
      });
    });
  </script>
</body>
</html>
